<div class="single-post">
  <article class="post-card">
    <div class="post-header">
      <h2 class="post-title">{{post.title}}</h2>
      <div class="post-meta">
        Posted by {{post.user.username}} on {{format_date post.created_at}}
      </div>
    </div>

    <div class="post-content">
      <p>{{post.content}}</p>
    </div>
  </article>

  {{#if logged_in}}
    <div class="comment-form-container">
      <h3>Add a Comment</h3>
      <form id="comment-form" data-post-id="{{post.id}}">
        <div class="form-group">
          <textarea 
            id="comment-content" 
            name="content" 
            class="form-input"
            rows="3"
            placeholder="What are your thoughts?"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit Comment</button>
      </form>
    </div>
  {{else}}
    <p class="login-prompt">Please <a href="/login">login</a> to leave a comment.</p>
  {{/if}}

  <section class="comments">
    <h3>Comments</h3>
    {{#if post.comments.length}}
      {{#each post.comments as |comment|}}
        <div class="comment">
          <div class="comment-meta">
            <span class="comment-author">{{comment.user.username}}</span>
            <span class="comment-date">{{format_date comment.created_at}}</span>
          </div>
          <p class="comment-content">{{comment.content}}</p>
          {{#if (is_owner comment.user_id ../user_id)}}
            <div class="comment-actions">
              <button class="btn btn-sm btn-danger delete-comment" data-id="{{comment.id}}">Delete</button>
            </div>
          {{/if}}
        </div>
      {{/each}}
    {{else}}
      <p class="no-comments">No comments yet. Be the first to comment!</p>
    {{/if}}
  </section>
</div>

<script src="/js/comments.js"></script>
{{#if logged_in}}
  <script src="/js/comment-handler.js"></script>
{{/if}}